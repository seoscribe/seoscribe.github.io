<!doctype html>
<html>
<style>
html{-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased;-webkit-font-smoothing:subpixel-antialiased;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-overflow-scrolling:touch;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;touch-action:manipulation;font:normal normal 400 16px/1.2 Roboto,-apple-system,Arial,Helmet,Freesans,sans-serif}
*,:before,:after{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;-webkit-user-select:none;-moz-user-select:none;touch-action:manipulation;margin:0;padding:0;border:0;font:inherit}:active,:focus{outline:0}article,footer,header,main,nav,section,video{display:block}
html,body{height:100%;background:#eee}
a{-webkit-text-decoration-skip:objects;text-decoration:none}button,input,textarea{-webkit-appearance:none;-webkit-border-radius:0;border-radius:0;background:0 0}button,img,video{-webkit-touch-callout:none}button,a,img,video{-webkit-user-select:none;-moz-user-select:none}button,a{color:inherit;cursor:pointer}textarea{resize:none}[disabled]{opacity:.6;cursor:not-allowed}[hidden],video::-webkit-media-controls,video::-webkit-media-controls-play-button,video::-webkit-media-controls-volume-slider,video::-webkit-media-controls-mute-button,video::-webkit-media-controls-timeline,video::-webkit-media-controls-current-time-display{display:none}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#07071c;-webkit-border-radius:4px;border-radius:4px}::-webkit-scrollbar-track{background-color:transparent;background:rgba(0,0,0,0)}::selection{background:#fff;color:#07071c}::-moz-selection{background:#fff;color:#07071c}
aside {position:fixed;top:0;left:0;padding:4rem 0 4rem 2rem;bottom:0;width:25%;width:calc(30% - 4rem)}
main {width:70%;padding:2rem 0;margin:0 2rem 0 auto;height:100%;}
main textarea{-webkit-overflow-scrolling:touch;padding:2rem;background:#fff;-webkit-border-radius:4px;border-radius:4px;-webkit-box-shadow:0 0 54px 0 rgba(0,0,0,.1);box-shadow:0 0 54px 0 rgba(0,0,0,.1);width:100%;height:100%;resize:none;overflow-x:hidden;overflow-y:scroll}
aside div{
  position:relative;
}
label[for]{font-size:10px;font-weight:700;text-transform:uppercase;}
output{
  display:block;
  padding:0 0 1rem 0;
}
</style>
<aside>
  <input id="keyword" type="text" value="keyword">
  <div>
    <label for="keyword_density">Keyword density</label>
    <output id="keyword_density">0</output>
  </div>
  <div>
    <label for="lsi_density">LSI density</label>
    <output id="lsi_density">0</output>
  </div>
  <div>
    <label for="keyword_headings">Keyword in headings</label>
    <output id="keyword_headings">No</output>
  </div>
  <div>
    <label for="keyword_first_paragraph">Keyword in first paragraph</label>
    <output id="keyword_first_paragraph">No</output>
  </div>
</aside>
<main>
  <textarea></textarea>
</main>
<script>
  ;(function(win,doc){
    var content = doc.getElementsByTagName('textarea')[0];

    content.addEventListener('blur',checkContent,false);
    content.addEventListener('keyup',checkContent,false);

    function checkContent(){
      var raw_k = []; raw_k[0] = doc.getElementById('keyword').value;
      var k = raw_k.length > 1 ? raw_k : raw_k[0];
      var kd = doc.getElementById('keyword_density');
      var kh = doc.getElementById('keyword_headings');
      var kfp = doc.getElementById('keyword_first_paragraph');
      var lsi_d = doc.getElementById('lsi_density');
      var lsi_words = [];

        var xhr = new XMLHttpRequest();
        var qs = raw_k.length > 1 ? k.join('+') : k;
        xhr.open('GET','https://api.datamuse.com/words?ml='+qs, true);
        //xhr.setRequestHeader('Content-Type','application/json');
        xhr.onreadystatechange = function(){
          if(xhr.readyState = 4 && xhr.status >= 200 && xhr.status < 300){
            var data = JSON.parse(xhr.responseText);
            console.log(data);
            for(var i = 0; i < data.length; ++i){
              lsi_words[i] = data[i].word;
            }
            console.log(lsi_words);
          }
        };
        xhr.onerror = function(){

        };
        xhr.send();

      var c_words = content.value.split(' ');
      var c_paras = content.value.split('\n');

      kd.value = 0;
      lsi_d.value = 0;

      kfp.value = 'No';

      if(c_paras.length > 0){
        c_paras[0].split(' ').forEach(function(word){
          if(word.trim() === k) kfp.value = 'Yes';
        });
        c_paras.forEach(function(para){
          para.split(' ').forEach(function(word){
            if(word.trim() === k){
              kd.value++;
            }
            else {
              lsi_words.forEach(function(lsi_word){
                if(word.trim() === lsi_word) lsi_d.value++;
              });
            }
          });
        });
      }
      else {
        c_words.forEach(function(word){
          if(word.trim() === k) kd.value++;
        });
        lsi_words.forEach(function(lsi_word){
          if(lsi_word.trim() === k) lsi_.value++;
        });
      }

    }

  })(window,window.document);
</script>
</html>
